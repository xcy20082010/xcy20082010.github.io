<!DOCTYPE html>
<html>
<head>
    <style>
        /* 按钮样式 */
        #ttsBtn {
            padding: 12px 24px;
            background: #0078d4;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            position: fixed;
            bottom: 30px;
            right: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        /* 移动端适配 */
        @media (max-width: 768px) {
            #ttsBtn { 
                width: 80%;
                right: 10%;
                bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- 网页正文内容 -->
    <div id="content">
        <h1>智能朗读示例</h1>
        <p>这里是要朗读的文本内容...</p>
    </div>

    <!-- 朗读控制按钮 -->
    <button id="ttsBtn">点击朗读</button>

    <script>
        let isSpeaking = false;
        const speech = window.speechSynthesis;
        const content = document.getElementById('content').textContent;

        // 核心功能
        function toggleSpeech() {
            if (isSpeaking) {
                speech.cancel();
                isSpeaking = false;
            } else {
                // 分段处理长文本（兼容iOS）
                const chunks = content.match(/[\s\S]{1,500}/g) || [];
                chunks.forEach((text, index) => {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'zh-CN';
                    utterance.rate = 0.9; // 语速调节
                    utterance.onend = () => {
                        if (index === chunks.length-1) isSpeaking = false;
                    }
                    speech.speak(utterance);
                });
                isSpeaking = true;
            }
        }

        // 按钮交互
        document.getElementById('ttsBtn').addEventListener('click', () => {
            // iOS需用户主动触发
            if (speech.pending) return;
            toggleSpeech();
        });

        // 移动端兼容处理
        if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
            document.body.style.webkitUserSelect = 'none'; // 禁止文本选择
            document.getElementById('ttsBtn').style.webkitTapHighlightColor = 'transparent'; // 去除点击高亮
        }
    </script>

    <!-- 第三方服务备用方案 -->
    <script>
        // Web Speech API不可用时启用Azure TTS
        if (!window.speechSynthesis) {
            document.getElementById('ttsBtn').onclick = () => {
                const audio = new Audio();
                audio.src = `https://tts-proxy.example.com?text=${encodeURIComponent(content)}`;
                audio.play(); 
            }
        }
    </script>
</body>
</html>
